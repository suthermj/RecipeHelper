@using RecipeHelper.Models.Kroger
@using RecipeHelper.Models.Dinner
@model ReviewDinnerSelectionsVM

<div class="max-w-6xl mx-auto px-4 py-8 space-y-8">
    <!-- existing header + selected recipes stuff above... -->
    <!-- Ingredients -->
    <section class="space-y-4">
        <div class="flex items-center justify-between">
            <h2 class="text-lg font-semibold text-gray-900">Combined ingredients</h2>
            <p class="text-xs text-gray-500">
                Quantities are summed across all selected recipes and shown with their units.
            </p>
        </div>

        @if (Model.Ingredients == null || !Model.Ingredients.Any())
        {
            <p class="text-sm text-gray-500">
                No ingredients to display. Make sure you’ve selected at least one recipe.
            </p>
        }
        else
        {
            <!-- Start form -->
            <form asp-controller="Cart"
                  asp-action="AddToCart"
                  method="post"
                  id="add-to-kroger-form"
                  class="space-y-4">
                @Html.AntiForgeryToken()

                <div class="overflow-x-auto bg-white rounded-2xl shadow-sm border border-gray-200">
                    <table class="min-w-full divide-y divide-gray-200 text-sm">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left font-medium text-gray-600">
                                    Ingredient
                                </th>
                                <th class="px-4 py-3 text-left font-medium text-gray-600">
                                    Quantity needed
                                </th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            @for (var i = 0; i < Model.Ingredients.Count; i++)
                            {
                                var item = Model.Ingredients[i];

                                <tr class="hover:bg-gray-50">
                                    <td class="px-4 py-3 align-top">
                                        <span class="font-medium text-gray-900">
                                            @item.Name
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 align-top">
                                        <span class="text-gray-800 font-medium">
                                            @item.Quantity @item.Measurement
                                        </span>
                                    </td>
                                </tr>

                                @* Hidden inputs that will populate AddToCartVM.Items[i] *@
                                <input type="hidden" name="Items[@i].Upc" value="@item.Upc" />
                                <input type="hidden" name="Items[@i].Quantity" value="@item.Quantity" />
                                <input type="hidden" name="Items[@i].Modality" value="DELIVERY" />
                            }
                        </tbody>
                    </table>
                </div>

                <div class="flex justify-end pt-3">
                    <button type="submit"
                            id="add-to-kroger-button"
                            class="inline-flex items-center justify-center px-5 py-2.5 rounded-full text-sm font-semibold bg-green-600 text-white hover:bg-green-700 transition">
                        Add all ingredients to Kroger cart
                    </button>
                </div>
            </form>
        }
    </section>
</div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var form = document.getElementById('add-to-kroger-form');
            if (!form) return;

            var button = document.getElementById('add-to-kroger-button');
            if (!button) return;

            form.addEventListener('submit', function () {
                // Prevent double clicks
                button.disabled = true;

                // Optional: light visual change
                button.classList.add('opacity-70', 'cursor-not-allowed');

                // Change text to show progress
                button.dataset.originalText = button.textContent;
                button.textContent = 'Adding to Kroger...';
            });
        });
    </script>