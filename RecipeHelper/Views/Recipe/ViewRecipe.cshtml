@model ViewRecipeVM

@{
    var hasImage = !string.IsNullOrWhiteSpace(Model?.ImageUri);
    var hasIngredients = Model.Ingredients != null && Model.Ingredients.Any();
    var hasInstructions = Model.Instructions != null && Model.Instructions.Any();
}

<!-- Hero image (full-bleed on mobile, contained on desktop) -->
@if (hasImage)
{
    <div class="w-full max-w-5xl mx-auto lg:px-6 lg:pt-8 -mx-4 sm:mx-auto">
        <img src="@Model.ImageUri"
             alt="Image of @Model.RecipeName"
             class="w-full h-56 sm:h-72 lg:h-80 object-cover lg:rounded-2xl" />
    </div>
}

<div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 @(hasImage ? "pt-6" : "pt-10") pb-10 overflow-x-hidden">

    <!-- Header -->
    <header class="mb-6">
        <a asp-controller="Recipe" asp-action="Recipe"
           class="inline-flex items-center gap-1 text-sm text-gray-500 hover:text-gray-700 mb-3 transition">
            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
            </svg>
            All Recipes
        </a>

        <div class="flex items-start justify-between gap-4">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 leading-tight">
                @Model.RecipeName
            </h1>

            <div class="flex items-center gap-2 flex-shrink-0">
                <a asp-controller="Recipe" asp-action="CreateEditRecipe" asp-route-id="@Model.Id"
                   class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-full bg-blue-600 text-white hover:bg-blue-700 shadow-sm transition">
                    Edit
                </a>
                <form asp-controller="Recipe"
                      asp-action="DeleteRecipe"
                      asp-route-id="@Model.Id"
                      method="post"
                      class="inline">
                    @Html.AntiForgeryToken()
                    <button type="submit"
                            class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-full border border-gray-300 text-gray-600 bg-white hover:bg-red-50 hover:text-red-600 hover:border-red-200 transition"
                            onclick="return confirm('Are you sure you want to delete this recipe?');">
                        Delete
                    </button>
                </form>
            </div>
        </div>
    </header>

    <!-- Ingredients -->
    <section class="mb-8">
        <h2 class="text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2">
            Ingredients
            @if (hasIngredients)
            {
                <span class="inline-flex items-center rounded-full bg-emerald-50 px-2.5 py-0.5 text-xs font-medium text-emerald-700 border border-emerald-100">
                    @Model.Ingredients.Count
                </span>
            }
        </h2>

        @if (hasIngredients)
        {
            <ul class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                @foreach (var ingredient in Model.Ingredients)
                {
                    <li class="flex items-baseline gap-2 rounded-lg bg-gray-50 px-3 py-2.5 text-sm min-w-0">
                        <span class="font-semibold text-gray-900 whitespace-nowrap flex-shrink-0">
                            @ingredient.DisplayQuantity @ingredient.DisplayMeasurement
                        </span>
                        <span class="text-gray-600 break-words min-w-0">
                            @ingredient.Name
                        </span>
                    </li>
                }
            </ul>
        }
        else
        {
            <p class="text-gray-500 text-sm">
                No ingredients listed for this recipe yet.
            </p>
        }
    </section>

    <!-- Instructions -->
    @if (hasInstructions)
    {
        <section>
            <h2 class="text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2">
                Instructions
                <span class="inline-flex items-center rounded-full bg-blue-50 px-2.5 py-0.5 text-xs font-medium text-blue-700 border border-blue-100">
                    @Model.Instructions.Count step@(Model.Instructions.Count == 1 ? "" : "s")
                </span>
            </h2>

            <ol id="stepsOl" class="space-y-3">
                @for (var i = 0; i < Model.Instructions.Count; i++)
                {
                    <li class="step-item flex gap-3 rounded-xl bg-gray-50 px-4 py-3 cursor-pointer select-none transition-colors min-w-0"
                        data-step="@i">
                        <span class="step-number flex-shrink-0 flex items-center justify-center h-7 w-7 rounded-full bg-blue-600 text-white text-xs font-bold transition-colors">
                            @(i + 1)
                        </span>
                        <span class="text-gray-700 text-sm sm:text-base leading-relaxed break-words min-w-0">
                            @Model.Instructions[i]
                        </span>
                    </li>
                }
            </ol>
        </section>
    }
</div>

@section Scripts {
    <script>
        (function () {
            const ol = document.getElementById('stepsOl');
            if (!ol) return;

            ol.addEventListener('click', function (e) {
                const li = e.target.closest('.step-item');
                if (!li) return;

                const wasActive = li.classList.contains('is-active');

                // clear all
                ol.querySelectorAll('.step-item.is-active').forEach(el => {
                    el.classList.remove('is-active', 'bg-blue-50', 'ring-2', 'ring-blue-200');
                    el.classList.add('bg-gray-50');
                    el.querySelector('.step-number')?.classList.remove('bg-blue-700', 'scale-110');
                    el.querySelector('.step-number')?.classList.add('bg-blue-600');
                });

                if (wasActive) return; // toggled off

                // activate tapped step
                li.classList.add('is-active', 'bg-blue-50', 'ring-2', 'ring-blue-200');
                li.classList.remove('bg-gray-50');
                li.querySelector('.step-number')?.classList.add('bg-blue-700', 'scale-110');
                li.querySelector('.step-number')?.classList.remove('bg-blue-600');
            });
        })();
    </script>
}
